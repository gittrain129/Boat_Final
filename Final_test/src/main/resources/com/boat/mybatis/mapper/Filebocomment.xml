<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.boat.mybatis.mapper.FileComMapper">
  
  <!-- 
   	private String F_C_NUM;
	private String F_C_ID;
	private String F_CONTENT;
	private String F_COMMENT_DATE;//2020-12-24 16:08:35
	private int F_BO_NUM;
	private int F_COMMENT_RE_LEV;                         DATE
 
 create table file_board (
	FILE_NUM NUMBER(5) primary key,
	FILE_NAME VARCHAR2(30), 
	FILE_PASS NUMBER(30),
	FILE_SUBJECT VARCHAR2(300),	
	FILE_CONTENT VARCHAR2(4000),		
	FILE_FILE VARCHAR2(50),
	FILE_FILE2 VARCHAR2(50),		
	FILE_RE_REF NUMBER(5),	
	FILE_RE_LEV NUMBER(5),	
	FILE_RE_SEQ NUMBER(5),
	FILE_READCOUNT NUMBER(5),
	FILE_DATE DATE ,
	DEPT VARCHAR2(30) check (dept in ('홍보팀', '개발팀', '인사팀', '기획팀', '영업팀')),
	FIlE_EMPNO varchar2(50)
	);
 
  -->
  
  
	<select id="getListCount" resultType="int">
		select count(*) from FILE_COMMENT
		where F_COMMENT_NUM =#{F_COMMENT_NUM}
	</select>
	
  <select id = "getCommentList" resultType="Filebo" parameterType="java.util.Map">
	
	select F_C_NUM, FILE_COMMENT.F_C_ID, F_CONTENT, F_COMMENT_DATE, F_COMMENT_RE_LEV, 
				   F_COMMENT_RE_SEQ, F_COMMENT_RE_REF 
				   from FILE_COMMENT join member 
				   on FILE_COMMENT.F_C_ID = member.empno 
				   where F_COMMENT_NUM = #{F_COMMENT_NUM} 
				   order by F_COMMENT_RE_REF 
                   <if test='state=="1"'>
                   asc,
                   </if>
                   <if test='state=="0"'>
                   desc,
                   </if>  
                    F_COMMENT_RE_SEQ asc
  
  </select>
  
  			 
  <insert id = "insertBoard" parameterType = "Filebo">
	  <selectKey resultType="int" order ="BEFORE" keyProperty ="FILE_NUM">
	  	 select nvl(max(FILE_NUM ),0)+1 from file_board 
	  
	  </selectKey>
	 insert into file_board 
  (FILE_NUM ,FILE_NAME ,FILE_PASS ,FILE_SUBJECT ,
  FILE_CONTENT ,FILE_FILE ,FILE_ORIGINAL,FILE_RE_REF ,
  FILE_RE_LEV ,FILE_RE_SEQ ,FILE_READCOUNT ,FILE_DATE )
  values
  (
  #{FILE_NUM},#{FILE_NAME},#{FILE_PASS},#{FILE_SUBJECT},#{FILE_CONTENT},
  #{FILE_FILE,jdbcType=VARCHAR}, #{FILE_ORIGINAL,jdbcType=VARCHAR},
  #{FILE_NUM},#{FILE_RE_LEV},#{FILE_RE_SEQ},#{FILE_READCOUNT},SYSDATE)
  </insert>
  
  <select id ="getDetail" parameterType ="Filebo" resultType = "Filebo">
	select * from file_board  
   where 
  FILE_NUM = #{number}
  </select>
  
  <update id="setReadCountUpdate" parameterType ="int">
	update file_board
  set FILE_READCOUNT  = FILE_READCOUNT +1
  where FILE_NUM = #{number}
  </update>
  
  <!--  map은 java.util.Map의 별칭입니다.-->
  <select id = "isBoardWriter" parameterType = "map" resultType="Filebo" >
 select * from file_board
  where FILE_NUM=#{num}
  and FILE_PASS=#{pass}
  </select>
  
  <update id="boardModify" parameterType = "Filebo" >
	update file_board
  set
  FILE_SUBJECT  = #{FILE_SUBJECT },
  FILE_CONTENT  = #{FILE_CONTENT },
  FILE_FILE   = #{FILE_FILE ,jdbcType=VARCHAR},
  BOARD_ORIGINAL = #{BOARD_ORIGINAL,jdbcType=VARCHAR}
 where
  FILE_NUM  =#{FILE_NUM }
  
  </update>
  
  <insert id = "boardReply" parameterType = "Filebo">
  	<selectKey resultType="int" order ="BEFORE" keyProperty ="FILE_NUM">
 		 select nvl(max(FILE_NUM ),0)+1 from file_board 
  	</selectKey>
 insert into file_board  
					(FILE_NUM,FILE_NAME  ,FILE_PASS ,FILE_SUBJECT ,
					FILE_CONTENT, FILE_RE_REF ,
					FILE_RE_LEV , FILE_RE_SEQ , FILE_READCOUNT ,FILE_DATE ) 
values( #{FILE_NUM},#{FILE_NAME },#{FILE_PASS },#{FILE_SUBJECT },#{FILE_CONTENT },
					#{FILE_RE_REF },#{FILE_RE_LEV },#{FILE_RE_SEQ },#{FILE_READCOUNT },sysdate)
  </insert>
  
  <update id = "boardReplyUpdate" parameterType = "Filebo">
  	  update file_board  set FILE_RE_SEQ  = FILE_RE_SEQ +1 
					where FILE_RE_REF  = #{FILE_RE_REF }
					and FILE_RE_SEQ  <![CDATA[ > ]]> #{FILE_RE_SEQ }
  </update>
  
  <delete id="boardDelete" parameterType = "int">
 <![CDATA[
  delete from file_board  
			where FILE_RE_REF  = #{FILE_RE_REF} 
			and FILE_RE_LEV   > =#{FILE_RE_LEV} 
			and FILE_RE_SEQ   > =#{FILE_RE_SEQ} 
			and FILE_RE_SEQ   < =(  
							 		nvl((select min(FILE_RE_SEQ) -1 
									  from file_board
									  where FILE_RE_REF = #{FILE_RE_REF} 
									  and FILE_RE_LEV = #{FILE_RE_LEV}
									  and FILE_RE_SEQ  > #{FILE_RE_SEQ}),
									(select max(FILE_RE_SEQ)
								 		from file_board
										 where FILE_RE_REF = #{FILE_RE_REF})))
  ]]>
  </delete>
   <select id ="getDeleteFileList" resultType ="String"> 
   select board_file from delete_file
  </select>
  
  <delete id="deleteFileList" parameterType ="String">
  delete from delete_file where board_file=#{filename}
  </delete>
  
 </mapper>